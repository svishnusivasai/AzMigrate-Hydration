<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <!-- Generate cs file from T4 templates as part of build .-->
    <TransformOnBuild>true</TransformOnBuild>
    <!--
      List of targets that should be run before the transforming.
      Run PrepareForBuild before transforming tt files because PrepareForBuild creates the
      IntermediateOutputPath which is required for t4 template processing.
    -->
    <BeforeTransform>PrepareForBuild</BeforeTransform>
    <!--
      Explicitly mention cs files as https://aka.ms/sdkimplicititems not jelling with
      T4 code generation.
    -->
    <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
  </PropertyGroup>
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">x64</Platform>
    <ProjectGuid>{2CB4C8B8-76B3-4821-8110-10DCDCA30C8D}</ProjectGuid>
    <OutputType>Exe</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>MarsAgent</RootNamespace>
    <AssemblyName>MarsAgent</AssemblyName>
    <TargetFrameworkVersion>v4.6.2</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
    <TargetFrameworkProfile />
    <LocApply>true</LocApply>
    <LocNeutralLanguage Condition="'$(LocNeutralLanguage)'==''">en</LocNeutralLanguage>
    <!--
      The new SDK format does not work well with auto-generated files.
      Disable inclusion of the auto-generated resource file and explicitly add it to the csproj.
    -->
    <EnableDefaultEmbeddedResourceItems>false</EnableDefaultEmbeddedResourceItems>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|x64' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <RunCodeAnalysis>true</RunCodeAnalysis>
    <CodeAnalysisIgnoreGeneratedCode>false</CodeAnalysisIgnoreGeneratedCode>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <PlatformTarget>x64</PlatformTarget>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|x64' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <OutputPath>bin\Release\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <RunCodeAnalysis>true</RunCodeAnalysis>
    <CodeAnalysisIgnoreGeneratedCode>false</CodeAnalysisIgnoreGeneratedCode>
    <PlatformTarget>x64</PlatformTarget>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
  </PropertyGroup>
  <PropertyGroup>
    <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
  </PropertyGroup>
  <PropertyGroup>
    <CodeGeneratorIncludeFolder>..\..\packages\CodeGenerator.1.0.0.84\content\ttinclude</CodeGeneratorIncludeFolder>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="AadUtilities, Version=$(MARS_AGENT_AADUTILITIES_VERSION)">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_AADUTILITIES_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.ApplicationInsights, Version=$(AI_VERSION), Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(AI_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.AI.ServerTelemetryChannel, Version=$(AI_SRVTELCHANNEL_VERSION), Culture=neutral, publicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(AI_SRVTELCHANNEL_PATH)</HintPath>
    </Reference>
    <Reference Include="CodeGenerator, Version=$(MARS_AGENT_CODEGEN_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_CODEGEN_EXEPATH)</HintPath>
    </Reference>
    <Reference Include="ClientLibHelpers, Version=$(MARS_AGENT_RCM_CLIENT_LIB_HELPERS_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_RCM_CLIENT_LIB_HELPERS_PATH)</HintPath>
    </Reference>
    <Reference Include="LoggerBase, Version=$(MARS_AGENT_LOGGER_BASE_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_LOGGER_BASE_PATH)</HintPath>
    </Reference>
    <Reference Include="LoggerInterface, Version=$(MARS_AGENT_LOGGER_INTERFACE_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_LOGGER_INTERFACE_PATH)</HintPath>
    </Reference>
    <Reference Include="MetricsEmitterInterface, Version=$(MARS_AGENT_METRICSEMIT_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_METRICSEMIT_PATH)</HintPath>
    </Reference>
    <Reference Include="MetricsHelper, Version=$(MARS_AGENT_METRICSHELPER_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_METRICSHELPER_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.AspNetCore.DataProtection.Abstractions">
      <HintPath>$(MARS_AGENT_DP_LOG_ABS_PATH)</HintPath>
    </Reference>
	<Reference Include="Microsoft.Bcl.AsyncInterfaces">
      <HintPath>$(MARS_AGENT_BCL_ASYNC_INT_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="Microsoft.Extensions.Caching.Abstractions , Version=$(MARS_AGENT_EXT_CACHING_VERSION)">
      <HintPath>$(MARS_AGENT_EXT_CACHING_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.Extensions.Caching.Memory, Version=$(MARS_AGENT_EXT_CACHING_MEM_VERSION)">
      <HintPath>$(MARS_AGENT_EXT_CACHING_MEM_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.Extensions.DependencyInjection, Version=$(MARS_AGENT_EXT_DEP_INJ_VERSION)">
      <HintPath>$(MARS_AGENT_EXT_DEP_INJ_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.Extensions.DependencyInjection.Abstractions, Version=$(MARS_AGENT_EXT_DEP_INJ_ABS_VERSION)">
      <HintPath>$(MARS_AGENT_EXT_DEP_INJ_ABS_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.Extensions.Logging, Version=$(MARS_AGENT_EXT_LOG_VERSION)">
      <HintPath>$(MARS_AGENT_EXT_LOG_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.Extensions.Logging.Abstractions, Version=$(MARS_AGENT_EXT_LOG_ABS_VERSION), Culture=neutral, PublicKeyToken=adb9793829ddae60, processorArchitecture=MSIL">
      <HintPath>$(MARS_AGENT_EXT_LOG_ABS_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.Extensions.Options, Version=$(MARS_AGENT_EXT_OPTION_VERSION)">
      <HintPath>$(MARS_AGENT_EXT_OPTION_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.Extensions.Primitives, Version=$(MARS_AGENT_EXT_PRIM_VERSION)">
      <HintPath>$(MARS_AGENT_EXT_PRIM_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.Identity.Client, Version=$(MSAL_VERSION), Culture=neutral, PublicKeyToken=0a613f4dd989e8ae, processorArchitecture=MSIL">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MSAL_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.Identity.Web.TokenCache, Version=$(MSAL_WEB_VERSION)">
      <HintPath>$(MSAL_WEB_PATH)</HintPath>
    </Reference>
	<Reference Include="Microsoft.IdentityModel.Abstractions, Version=$(MSAB_VERSION), Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MSAB_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.ServiceBus, Version=$(MARS_AGENT_SERVICE_BUS_VERSION), Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_SERVICE_BUS_PATH)</HintPath>
    </Reference>
    <Reference Include="Microsoft.ServiceBus.Messaging.EventProcessorHost, Version=$(MARS_AGENT_SBUS_EVENT_VERSION)">
      <HintPath>$(MARS_AGENT_SBUS_EVENT_PATH)</HintPath>
    </Reference>
    <Reference Include="MTReplicationProviderLib, Version=$(MARS_AGENT_MT_REP_PROVIDER_VERSION)">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_MT_REP_PROVIDER)</HintPath>
    </Reference>
    <Reference Include="Newtonsoft.Json, Version=$(MARS_AGENT_NEWTONSOFTJSON_VERSION), Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed, processorArchitecture=MSIL">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_NEWTONSOFTJSON_PATH)</HintPath>
    </Reference>
    <Reference Include="RcmAgentCommonLib, Version=$(MARS_AGENT_RCM_AGENT_COMMON_LIB_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_RCM_AGENT_COMMON_LIB_PATH)</HintPath>
    </Reference>
    <Reference Include="RcmClientLib, Version=$(MARS_AGENT_RCM_CLIENT_LIB_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_RCM_CLIENT_LIB_PATH)</HintPath>
    </Reference>
    <Reference Include="RcmCommonUtils, Version=$(MARS_AGENT_RCM_COMM_UTILS_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_RCM_COMM_UTILS_PATH)</HintPath>
    </Reference>
    <Reference Include="RcmContract, Version=$(MARS_AGENT_RCM_CONTRACT_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_RCM_CONTRACT_PATH)</HintPath>
    </Reference>
    <Reference Include="RcmMetricsHotPathToWarmPathCodeGenerator, Version=$(MARS_AGENT_RCM_PATH_CG_VERSION), Culture=neutral, processorArchitecture=AMD64">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_RCM_PATH_CG_PATH)</HintPath>
    </Reference>
    <Reference Include="System" />
    <Reference Include="System.Configuration.Install" />
    <Reference Include="System.Data" />
    <Reference Include="System.Data.DataSetExtensions" />
    <Reference Include="System.Management" />
    <Reference Include="System.Runtime.Serialization" />
    <Reference Include="System.ServiceProcess" />
    <Reference Include="System.Threading.Tasks.Extensions, Version=$(MARS_AGENT_THREAD_TASK_EXT_VERSION), Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51, processorArchitecture=MSIL">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_THREAD_TASK_EXT_PATH)</HintPath>
    </Reference>
    <Reference Include="System.ValueTuple, Version=$(MARS_AGENT_VALUE_TUPLE_VERSION), Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51, processorArchitecture=MSIL">
      <SpecificVersion>True</SpecificVersion>
      <HintPath>$(MARS_AGENT_VALUE_TUPLE_PATH)</HintPath>
    </Reference>
    <Reference Include="System.Xml" />
  </ItemGroup>
  <ItemGroup>
    <!--
      The new SDK format does not work well with auto-generated files. In case the file was 
      present, it will be picked up in the compile list. In case it was not, add it explicitly
      so that the project is compiled with it.
    -->
    <Compile Condition="!Exists('$(ProjectDir)\ErrorHandling\Auto-Generated\MarsAgentExceptionEnum.codegen.cs')" Include="$(ProjectDir)\ErrorHandling\Auto-Generated\MarsAgentExceptionEnum.codegen.cs" />
    <Compile Condition="!Exists('$(ProjectDir)\ErrorHandling\Auto-Generated\MarsAgentExceptionClass.codegen.cs')" Include="$(ProjectDir)\ErrorHandling\Auto-Generated\MarsAgentExceptionClass.codegen.cs" />
    <Compile Condition="!Exists('$(ProjectDir)\Logger\Auto-Generated\MarsAgentEvents.codegen.cs')" Include="$(ProjectDir)\Logger\Auto-Generated\MarsAgentEvents.codegen.cs" />
    <Compile Condition="!Exists('$(ProjectDir)\Logger\Auto-Generated\MarsAgentMetrics.cs')" Include="$(ProjectDir)\Logger\Auto-Generated\MarsAgentMetrics.cs" />
  </ItemGroup>
  <ItemGroup>
    <None Include=".editorconfig" />
    <None Include="App.config">
      <SubType>Designer</SubType>
    </None>
  </ItemGroup>
  <ItemGroup>
    <None Include="Logger\MarsAgentEvents.tt">
      <Generator>TextTemplatingFileGenerator</Generator>
      <OutputFilePath>$(ProjectDir)\Logger\Auto-Generated</OutputFilePath>
      <LastGenOutput>MarsAgentEvents.codegen.cs</LastGenOutput>
    </None>
    <None Include="ErrorHandling\MarsAgentExceptionEnum.tt">
      <Generator>TextTemplatingFileGenerator</Generator>
      <OutputFilePath>$(ProjectDir)\ErrorHandling\Auto-Generated</OutputFilePath>
      <LastGenOutput>MarsAgentExceptionEnum.codegen.cs</LastGenOutput>
    </None>
    <None Include="ErrorHandling\MarsAgentExceptionClass.tt">
      <Generator>TextTemplatingFileGenerator</Generator>
      <OutputFilePath>$(ProjectDir)\ErrorHandling\Auto-Generated</OutputFilePath>
      <LastGenOutput>MarsAgentExceptionClass.codegen.cs</LastGenOutput>
    </None>
    <None Include="ErrorHandling\MarsAgentErrorsResxFile.tt">
      <Generator>TextTemplatingFileGenerator</Generator>
      <OutputFilePath>$(ProjectDir)\ErrorHandling</OutputFilePath>
      <LastGenOutput>MarsAgentErrorsResxFile.resx</LastGenOutput>
    </None>
  </ItemGroup>
  <ItemGroup>
    <EmbeddedResource Include="ErrorHandling\Resources\Errors.$(LocNeutralLanguage).resx">
      <Localizable>True</Localizable>
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>MarsAgentErrorsResxFile.tt</DependentUpon>
    </EmbeddedResource>
    <EmbeddedResource Include="ProjectInstaller.resx">
      <DependentUpon>ProjectInstaller.cs</DependentUpon>
    </EmbeddedResource>
  </ItemGroup>
  <ItemGroup>
    <!--
      With the T4 generation of code, the advantage of the new SDK format auto including files to
      compile is lost. However, since wildcards are suppported, we will use that to include all the
      cs files. This is better than listing all the files individually.
    -->
    <Compile Include="CBEngine\**\*.cs" />
    <Compile Include="Config\**\*.cs" />
    <Compile Include="Constants\**\*.cs" />
    <Compile Include="ErrorHandling\**\*.cs" />
    <Compile Include="Logger\**\*.cs" />
    <Compile Include="Monitoring\*.cs" />
    <Compile Include="Service\CBEngine\CBEgineLogUploadTask.cs" />
    <Compile Include="Service\CBEngine\MonitorCBEngineLogsTask.cs" />
    <Compile Include="Service\ConsumeSettingsTask.cs" />
    <Compile Include="Service\Jobs\UnsupportedJobExecution.cs" />
    <Compile Include="Service\MarsAgentService.cs">
      <SubType>Component</SubType>
    </Compile>
    <Compile Include="Service\MarsAgentService.Designer.cs" />
    <Compile Include="Service\ProcessCollectionSingleton.cs" />
    <Compile Include="Service\RcmAgentTaskLogContext.cs" />
    <Compile Include="Service\ReportComponentHealthTask.cs" />
    <Compile Include="Service\ServiceHealth.cs" />
    <Compile Include="Service\ServiceProperties.cs" />
    <Compile Include="Service\ServicePropertiesBase.cs" />
    <Compile Include="Service\ServiceSettings.cs" />
    <Compile Include="Service\ServiceTunables.cs" />
    <Compile Include="Utilities\**\*.cs" />
    <Compile Include="Program.cs" />
    <Compile Include="ProjectInstaller.cs">
      <SubType>Component</SubType>
    </Compile>
    <Compile Include="ProjectInstaller.Designer.cs" />
    <Compile Include="..\..\host\common\version.cs">
      <Link>version.cs</Link>
    </Compile>
  </ItemGroup>
  <ItemGroup>
    <!--
      The new SDK format does not pickup the XML files as Content file by default.
      Include all the XML files in the project as content files.
    -->
    <Content Include="**\*.xml" />
  </ItemGroup>
  <ItemGroup>
    <QCustomOutput Include="$(ProjectDir)\ErrorHandling\Resources\Errors.$(LocNeutralLanguage).resx">
      <Visible>false</Visible>
    </QCustomOutput>
  </ItemGroup>
  <ItemGroup>
    <Service Include="{508349B6-6B84-4DF5-91F0-309BEEBAD82D}" />
  </ItemGroup>
  <ItemGroup>
    <BootstrapperPackage Include=".NETFramework,Version=v4.6.2">
      <Visible>False</Visible>
      <ProductName>Microsoft .NET Framework 4.6.2 %28x86 and x64%29</ProductName>
      <Install>true</Install>
    </BootstrapperPackage>
    <BootstrapperPackage Include="Microsoft.Net.Framework.3.5.SP1">
      <Visible>False</Visible>
      <ProductName>.NET Framework 3.5 SP1</ProductName>
      <Install>false</Install>
    </BootstrapperPackage>
  </ItemGroup>
  <ItemGroup />
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
  <Import Project="..\..\host\win-rules.props" />
  <Target Name="GenerateError" BeforeTargets="BeforeBuild">
    <Message Text="Generating neutral language resource for Error" />
    <Delete Files="$(ProjectDir)\ErrorHandling\MarsAgentErrorsResxFile.resx" />
  </Target>
</Project>